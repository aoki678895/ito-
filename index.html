<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>itoしよ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #numberDisplay {
      font-size: 48px;
      margin: 20px 0;
      width: 150px;
      height: 200px;
      line-height: 200px;
      background-color: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 10px;
      display: inline-block;
      perspective: 1000px; /* 3D視点効果 */
    }
    .card {
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
    }
    .flipped .card {
      transform: rotateY(180deg);
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 10px;
    }
    .card-front {
      background-color: #f8f9fa;
      font-size: 24px;
      color: #333;
    }
    .card-back {
      background-color: #007bff;
      color: white;
      font-size: 48px;
      transform: rotateY(180deg);
    }
    button {
      padding: 10px 20px;
      font-size: 20px;
      margin: 5px;
    }
    #resetButton, #nextGameButton {
      display: block; /* ボタンをブロック要素にして縦に並べる */
      margin: 10px auto; /* 中央に配置 */
      width: 200px; /* 幅を指定（必要に応じて変更可能） */
    }
  </style>
</head>
<body>

  <h1>ito</h1>

  <!-- 人数選択画面 -->
  <div id="step1">
    <label for="peopleCount">人数を選択してください: </label>
    <input type="number" id="peopleCount" min="1" max="10" value="5">
    <button onclick="startGame()">開始</button>
  </div>

  <!-- 待機画面 -->
  <div id="step2" style="display:none;">
    <h2 id="currentPerson"></h2>
    <p>準備ができたら、ボタンを押してください。</p>
    <button onclick="showNumber()">数字を表示</button>
  </div>

  <!-- 数字表示画面 -->
  <div id="step3" style="display:none;">
    <div id="numberDisplay" class="card-container" onclick="flipCard()">
      <div class="card">
        <div class="card-front">カードをめくってください</div>
        <div class="card-back" id="numberValue">0</div>
      </div>
    </div>
    <button onclick="nextPerson()">次へ</button>
  </div>

  <!-- ゲーム終了画面 -->
  <div id="step4" style="display:none;">
    <h2>全員の数字表示が完了しました！</h2>
    <p id="resetMessage"></p>
    <p>現在のゲームセット数: <span id="gameCount">1</span></p>
    <button id="resetButton" style="display:none;" onclick="resetGame()">もう一度</button>
    <button id="nextGameButton" style="display:none;" onclick="startNextGame()">次のゲームへ</button>
  </div>

  <script>
    // 1〜100の配列を作成する関数
    function generateNumbers() {
      return Array.from({length: 100}, (_, i) => i + 1);
    }

    // 初期化
    let numbers = generateNumbers(); // 未使用の数字リスト
    let totalPeople = 0;
    let currentPersonIndex = 0;
    let gameCount = 1; // ゲームセット数

    // ゲーム開始時に人数を設定
    function startGame() {
      totalPeople = parseInt(document.getElementById('peopleCount').value);
      currentPersonIndex = 0;

      // ステップ1からステップ2へ
      document.getElementById('step1').style.display = 'none';
      document.getElementById('step2').style.display = 'block';
      updatePerson();
    }

    // 次の人の順番を表示
    function updatePerson() {
      document.getElementById('currentPerson').innerText = `第 ${currentPersonIndex + 1} 人目の番です。`;
    }

    // ランダムな数字を取得し、カードの裏に表示する
    function showNumber() {
      if (numbers.length === 0) {
        alert('全ての数字が表示されました');
        return;
      }

      // 使用済み数字を除外してランダムに選ぶ
      const randomIndex = Math.floor(Math.random() * numbers.length);
      const selectedNumber = numbers[randomIndex];

      // 選ばれた数字をリストから削除
      numbers.splice(randomIndex, 1);

      // 数字をカードの裏に設定
      document.getElementById('numberValue').innerText = selectedNumber;

      // ステップ2からステップ3へ
      document.getElementById('step2').style.display = 'none';
      document.getElementById('step3').style.display = 'block';
    }

    // カードをめくる（フリップ効果）
    function flipCard() {
      document.getElementById('numberDisplay').classList.toggle('flipped');
    }

    // 次の人に進む
    function nextPerson() {
      currentPersonIndex++;
      document.getElementById('numberDisplay').classList.remove('flipped'); // カードを元に戻す

      if (currentPersonIndex >= totalPeople) {
        // 全員が終了したら、終了画面へ
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step4').style.display = 'block';
        checkResetCondition(); // ゲーム終了時にリセット条件を確認
      } else {
        // 次の人に進む
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        updatePerson();
      }
    }

    // リセット条件を確認（数字が足りない場合のみリセット）
    function checkResetCondition() {
      const remainingNumbers = numbers.length;
      const resetMessage = document.getElementById('resetMessage');
      const resetButton = document.getElementById('resetButton');
      const nextGameButton = document.getElementById('nextGameButton');

      if (remainingNumbers >= totalPeople) {
        resetMessage.innerText = `まだ ${remainingNumbers} 個の数字が残っています。もう一度プレイできます。`;
        resetButton.style.display = 'none';
        nextGameButton.style.display = 'block';
      } else {
        resetMessage.innerText = `残りの数字が足りません。リセットして新しいゲームを始めてください。`;
        resetButton.style.display = 'block';
        nextGameButton.style.display = 'none';
      }
    }

    // ゲームをリセット
    function resetGame() {
      numbers = generateNumbers(); // 数字セットをリセット
      currentPersonIndex = 0;
      gameCount++;
      document.getElementById('gameCount').innerText = gameCount; // ゲームセット数を表示

      // ステップ4からステップ1へ
      document.getElementById('step4').style.display = 'none';
      document.getElementById('step1').style.display = 'block';
    }
  </script>

</body>
</html>
