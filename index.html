<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ランダムな数字表示</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #numberDisplay {
      font-size: 48px;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 20px;
      margin: 5px;
    }
  </style>
</head>
<body>

  <h1>ランダムな数字表示</h1>

  <!-- 人数選択画面 -->
  <div id="step1">
    <label for="peopleCount">人数を選択してください: </label>
    <input type="number" id="peopleCount" min="1" max="10" value="5">
    <button onclick="startGame()">開始</button>
  </div>

  <!-- 待機画面 -->
  <div id="step2" style="display:none;">
    <h2 id="currentPerson"></h2>
    <p>準備ができたら、ボタンを押してください。</p>
    <button onclick="showNumber()">数字を表示</button>
  </div>

  <!-- 数字表示画面 -->
  <div id="step3" style="display:none;">
    <div id="numberDisplay">ここに数字が表示されます</div>
    <button onclick="nextPerson()">次へ</button>
  </div>

  <!-- ゲーム終了画面 -->
  <div id="step4" style="display:none;">
    <h2>全員の数字表示が完了しました！</h2>
    <p id="resetMessage"></p>
    <p>現在のゲームセット数: <span id="gameCount">1</span></p>
    <button id="resetButton" style="display:none;" onclick="resetGame()">もう一度</button>
  </div>

  <script>
    // 1〜100の配列を作成する関数
    function generateNumbers() {
      return Array.from({length: 100}, (_, i) => i + 1);
    }

    // 初期化
    let numbers = generateNumbers();
    let usedNumbers = []; // 使用済み数字を保存する配列
    let totalPeople = 0;
    let currentPersonIndex = 0;
    let gameCount = 1; // ゲームセット数

    // ゲーム開始時に人数を設定
    function startGame() {
      totalPeople = parseInt(document.getElementById('peopleCount').value);
      currentPersonIndex = 0;

      // ステップ1からステップ2へ
      document.getElementById('step1').style.display = 'none';
      document.getElementById('step2').style.display = 'block';
      updatePerson();
    }

    // 現在の人の順番を表示
    function updatePerson() {
      document.getElementById('currentPerson').innerText = `第 ${currentPersonIndex + 1} 人目の番です。`;
    }

    // ランダムな数字を取得し、表示画面に遷移
    function showNumber() {
      if (numbers.length === 0) {
        alert('全ての数字が表示されました');
        return;
      }

      // 使用済み数字を除外してランダムに選ぶ
      const randomIndex = Math.floor(Math.random() * numbers.length);
      const selectedNumber = numbers[randomIndex];

      // 選ばれた数字をリストから削除し、使用済みの配列に追加
      numbers.splice(randomIndex, 1);  
      usedNumbers.push(selectedNumber); 

      // 数字を画面に表示
      document.getElementById('numberDisplay').innerText = selectedNumber;

      // ステップ2からステップ3へ
      document.getElementById('step2').style.display = 'none';
      document.getElementById('step3').style.display = 'block';
    }

    // 次の人に進む
    function nextPerson() {
      currentPersonIndex++;

      if (currentPersonIndex >= totalPeople) {
        // 全員が終了したら、終了画面へ
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step4').style.display = 'block';
        document.getElementById('gameCount').innerText = gameCount; // ゲームセット数を表示
        checkResetCondition(); // ゲーム終了時にリセット条件を確認
      } else {
        // 次の人に進む
        document.getElementById('step3').style.display = 'none';
        document.getElementById('step2').style.display = 'block';
        updatePerson();
      }
    }

    // リセット条件を確認
    function checkResetCondition() {
      const remainingNumbers = 100 - usedNumbers.length; // 残っている数字の数
      const resetMessage = document.getElementById('resetMessage');
      const resetButton = document.getElementById('resetButton');

      if (remainingNumbers >= totalPeople) {
        // 十分な数字が残っている場合
        resetMessage.innerText = `まだ ${remainingNumbers} 個の数字が残っています。もう一度プレイできます。`;
        resetButton.style.display = 'none'; // リセットボタンを表示しない
      } else {
        // 残りの数字が不足している場合
        resetMessage.innerText = `残りの数字が足りません。リセットして新しいゲームを始めてください。`;
        resetButton.style.display = 'block'; // リセットボタンを表示
      }
    }

    // ゲームをリセット
    function resetGame() {
      numbers = generateNumbers(); // 数字セットをリセット
      usedNumbers = []; // 使用済み数字をクリア
      totalPeople = 0;
      currentPersonIndex = 0;
      gameCount++; // ゲームセット数をカウント

      // ステップ4からステップ1へ
      document.getElementById('step4').style.display = 'none';
      document.getElementById('step1').style.display = 'block';
    }
  </script>

</body>
</html>
